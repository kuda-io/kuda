apiVersion: v1
kind: Namespace
metadata:
  labels:
    control-plane: controller-manager
  name: kuda-system
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.1
  creationTimestamp: null
  name: datas.data.kuda.io
spec:
  group: data.kuda.io
  names:
    kind: Data
    listKind: DataList
    plural: datas
    singular: data
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.ready
      name: Ready
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Data is the Schema for the data API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: Specification of the desired behavior of the Data.
            properties:
              dataItems:
                items:
                  description: DataItem describes the fields that each data item should have.
                  properties:
                    dataSourceType:
                      description: The type of data source for the data.
                      type: string
                    lifecycle:
                      description: Actions should be taken for the data.
                      properties:
                        postDownload:
                          description: PostDownload is called after data downloaded.
                          properties:
                            exec:
                              description: ExecAction describes a "run in container" action.
                              properties:
                                command:
                                  description: Command is the command line to execute inside the container, the working directory for the command  is root ('/') in the container's filesystem. The command is simply exec'd, it is not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use a shell, you need to explicitly call out to that shell. Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                                  items:
                                    type: string
                                  type: array
                              type: object
                            httpGet:
                              description: HTTPGetAction describes an action based on HTTP Get requests.
                              properties:
                                host:
                                  description: Host name to connect to, defaults to the pod IP. You probably want to set "Host" in httpHeaders instead.
                                  type: string
                                httpHeaders:
                                  description: Custom headers to set in the request. HTTP allows repeated headers.
                                  items:
                                    description: HTTPHeader describes a custom header to be used in HTTP probes
                                    properties:
                                      name:
                                        description: The header field name
                                        type: string
                                      value:
                                        description: The header field value
                                        type: string
                                    required:
                                    - name
                                    - value
                                    type: object
                                  type: array
                                path:
                                  description: Path to access on the HTTP server.
                                  type: string
                                port:
                                  anyOf:
                                  - type: integer
                                  - type: string
                                  description: Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME.
                                  x-kubernetes-int-or-string: true
                                scheme:
                                  description: Scheme to use for connecting to the host. Defaults to HTTP.
                                  type: string
                              required:
                              - port
                              type: object
                          type: object
                        preDownload:
                          description: PreDownload is called before data downloaded.
                          properties:
                            exec:
                              description: ExecAction describes a "run in container" action.
                              properties:
                                command:
                                  description: Command is the command line to execute inside the container, the working directory for the command  is root ('/') in the container's filesystem. The command is simply exec'd, it is not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use a shell, you need to explicitly call out to that shell. Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                                  items:
                                    type: string
                                  type: array
                              type: object
                            httpGet:
                              description: HTTPGetAction describes an action based on HTTP Get requests.
                              properties:
                                host:
                                  description: Host name to connect to, defaults to the pod IP. You probably want to set "Host" in httpHeaders instead.
                                  type: string
                                httpHeaders:
                                  description: Custom headers to set in the request. HTTP allows repeated headers.
                                  items:
                                    description: HTTPHeader describes a custom header to be used in HTTP probes
                                    properties:
                                      name:
                                        description: The header field name
                                        type: string
                                      value:
                                        description: The header field value
                                        type: string
                                    required:
                                    - name
                                    - value
                                    type: object
                                  type: array
                                path:
                                  description: Path to access on the HTTP server.
                                  type: string
                                port:
                                  anyOf:
                                  - type: integer
                                  - type: string
                                  description: Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME.
                                  x-kubernetes-int-or-string: true
                                scheme:
                                  description: Scheme to use for connecting to the host. Defaults to HTTP.
                                  type: string
                              required:
                              - port
                              type: object
                          type: object
                      type: object
                    localPath:
                      description: LocalPath defines the path of data in app container.
                      type: string
                    name:
                      description: Name of the data item. Each data item has a unique name in the same namespace.
                      type: string
                    namespace:
                      description: Namespace defines the space within which each name must be unique.
                      type: string
                    remotePath:
                      description: RemotePath defines the path of data on the remote storage.
                      type: string
                    version:
                      description: Version defines the version number of the data.
                      type: string
                  required:
                  - dataSourceType
                  - localPath
                  - name
                  - namespace
                  - remotePath
                  - version
                  type: object
                type: array
              dataSources:
                description: DataSources defines the attribute information of the related data sources.
                properties:
                  alluxio:
                    description: AlluxioDataSource defines the information of the alluxio data source.
                    properties:
                      host:
                        type: string
                      port:
                        type: integer
                      timeout:
                        type: integer
                    required:
                    - host
                    - port
                    type: object
                  hdfs:
                    description: HdfsDataSource defines the information of the hdfs data source.
                    properties:
                      addresses:
                        items:
                          type: string
                        type: array
                      userName:
                        type: string
                    required:
                    - addresses
                    - userName
                    type: object
                type: object
              lifecycle:
                description: Lifecycle describes actions that the kuda runtime should take in response to data lifecycle events.
                properties:
                  postDownload:
                    description: PostDownload is called after data downloaded.
                    properties:
                      exec:
                        description: ExecAction describes a "run in container" action.
                        properties:
                          command:
                            description: Command is the command line to execute inside the container, the working directory for the command  is root ('/') in the container's filesystem. The command is simply exec'd, it is not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use a shell, you need to explicitly call out to that shell. Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                            items:
                              type: string
                            type: array
                        type: object
                      httpGet:
                        description: HTTPGetAction describes an action based on HTTP Get requests.
                        properties:
                          host:
                            description: Host name to connect to, defaults to the pod IP. You probably want to set "Host" in httpHeaders instead.
                            type: string
                          httpHeaders:
                            description: Custom headers to set in the request. HTTP allows repeated headers.
                            items:
                              description: HTTPHeader describes a custom header to be used in HTTP probes
                              properties:
                                name:
                                  description: The header field name
                                  type: string
                                value:
                                  description: The header field value
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                          path:
                            description: Path to access on the HTTP server.
                            type: string
                          port:
                            anyOf:
                            - type: integer
                            - type: string
                            description: Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME.
                            x-kubernetes-int-or-string: true
                          scheme:
                            description: Scheme to use for connecting to the host. Defaults to HTTP.
                            type: string
                        required:
                        - port
                        type: object
                    type: object
                  preDownload:
                    description: PreDownload is called before data downloaded.
                    properties:
                      exec:
                        description: ExecAction describes a "run in container" action.
                        properties:
                          command:
                            description: Command is the command line to execute inside the container, the working directory for the command  is root ('/') in the container's filesystem. The command is simply exec'd, it is not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use a shell, you need to explicitly call out to that shell. Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                            items:
                              type: string
                            type: array
                        type: object
                      httpGet:
                        description: HTTPGetAction describes an action based on HTTP Get requests.
                        properties:
                          host:
                            description: Host name to connect to, defaults to the pod IP. You probably want to set "Host" in httpHeaders instead.
                            type: string
                          httpHeaders:
                            description: Custom headers to set in the request. HTTP allows repeated headers.
                            items:
                              description: HTTPHeader describes a custom header to be used in HTTP probes
                              properties:
                                name:
                                  description: The header field name
                                  type: string
                                value:
                                  description: The header field value
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                          path:
                            description: Path to access on the HTTP server.
                            type: string
                          port:
                            anyOf:
                            - type: integer
                            - type: string
                            description: Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME.
                            x-kubernetes-int-or-string: true
                          scheme:
                            description: Scheme to use for connecting to the host. Defaults to HTTP.
                            type: string
                        required:
                        - port
                        type: object
                    type: object
                type: object
            required:
            - dataItems
            - dataSources
            type: object
          status:
            description: Most recently observed status of the Data.
            properties:
              dataItems:
                type: integer
              dataItemsStatus:
                items:
                  description: DataItemStatus defines status fields for each data item.
                  properties:
                    message:
                      type: string
                    name:
                      type: string
                    namespace:
                      type: string
                    phase:
                      type: string
                    startTime:
                      format: date-time
                      type: string
                    version:
                      type: string
                  required:
                  - name
                  - namespace
                  - phase
                  - startTime
                  - version
                  type: object
                type: array
              downloading:
                type: integer
              failed:
                type: integer
              ready:
                type: string
              success:
                type: integer
              waiting:
                type: integer
            required:
            - dataItems
            - dataItemsStatus
            - downloading
            - failed
            - ready
            - success
            - waiting
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.1
  creationTimestamp: null
  name: datasets.data.kuda.io
spec:
  group: data.kuda.io
  names:
    kind: DataSet
    listKind: DataSetList
    plural: datasets
    singular: dataset
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.dataItems
      name: DataItems
      type: integer
    - jsonPath: .status.ready
      name: Ready
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: DataSet is the Schema for the datasets API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: Specification of the desired behavior of the DataSet.
            properties:
              template:
                description: Template describes the data resource that will be created.
                properties:
                  dataItems:
                    description: List of data items belonging to the data resource.
                    items:
                      description: DataItem describes the fields that each data item should have.
                      properties:
                        dataSourceType:
                          description: The type of data source for the data.
                          type: string
                        lifecycle:
                          description: Actions should be taken for the data.
                          properties:
                            postDownload:
                              description: PostDownload is called after data downloaded.
                              properties:
                                exec:
                                  description: ExecAction describes a "run in container" action.
                                  properties:
                                    command:
                                      description: Command is the command line to execute inside the container, the working directory for the command  is root ('/') in the container's filesystem. The command is simply exec'd, it is not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use a shell, you need to explicitly call out to that shell. Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                                      items:
                                        type: string
                                      type: array
                                  type: object
                                httpGet:
                                  description: HTTPGetAction describes an action based on HTTP Get requests.
                                  properties:
                                    host:
                                      description: Host name to connect to, defaults to the pod IP. You probably want to set "Host" in httpHeaders instead.
                                      type: string
                                    httpHeaders:
                                      description: Custom headers to set in the request. HTTP allows repeated headers.
                                      items:
                                        description: HTTPHeader describes a custom header to be used in HTTP probes
                                        properties:
                                          name:
                                            description: The header field name
                                            type: string
                                          value:
                                            description: The header field value
                                            type: string
                                        required:
                                        - name
                                        - value
                                        type: object
                                      type: array
                                    path:
                                      description: Path to access on the HTTP server.
                                      type: string
                                    port:
                                      anyOf:
                                      - type: integer
                                      - type: string
                                      description: Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME.
                                      x-kubernetes-int-or-string: true
                                    scheme:
                                      description: Scheme to use for connecting to the host. Defaults to HTTP.
                                      type: string
                                  required:
                                  - port
                                  type: object
                              type: object
                            preDownload:
                              description: PreDownload is called before data downloaded.
                              properties:
                                exec:
                                  description: ExecAction describes a "run in container" action.
                                  properties:
                                    command:
                                      description: Command is the command line to execute inside the container, the working directory for the command  is root ('/') in the container's filesystem. The command is simply exec'd, it is not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use a shell, you need to explicitly call out to that shell. Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                                      items:
                                        type: string
                                      type: array
                                  type: object
                                httpGet:
                                  description: HTTPGetAction describes an action based on HTTP Get requests.
                                  properties:
                                    host:
                                      description: Host name to connect to, defaults to the pod IP. You probably want to set "Host" in httpHeaders instead.
                                      type: string
                                    httpHeaders:
                                      description: Custom headers to set in the request. HTTP allows repeated headers.
                                      items:
                                        description: HTTPHeader describes a custom header to be used in HTTP probes
                                        properties:
                                          name:
                                            description: The header field name
                                            type: string
                                          value:
                                            description: The header field value
                                            type: string
                                        required:
                                        - name
                                        - value
                                        type: object
                                      type: array
                                    path:
                                      description: Path to access on the HTTP server.
                                      type: string
                                    port:
                                      anyOf:
                                      - type: integer
                                      - type: string
                                      description: Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME.
                                      x-kubernetes-int-or-string: true
                                    scheme:
                                      description: Scheme to use for connecting to the host. Defaults to HTTP.
                                      type: string
                                  required:
                                  - port
                                  type: object
                              type: object
                          type: object
                        localPath:
                          description: LocalPath defines the path of data in app container.
                          type: string
                        name:
                          description: Name of the data item. Each data item has a unique name in the same namespace.
                          type: string
                        namespace:
                          description: Namespace defines the space within which each name must be unique.
                          type: string
                        remotePath:
                          description: RemotePath defines the path of data on the remote storage.
                          type: string
                        version:
                          description: Version defines the version number of the data.
                          type: string
                      required:
                      - dataSourceType
                      - localPath
                      - name
                      - namespace
                      - remotePath
                      - version
                      type: object
                    type: array
                  dataSources:
                    description: List of data sources related to data storage.
                    properties:
                      alluxio:
                        description: AlluxioDataSource defines the information of the alluxio data source.
                        properties:
                          host:
                            type: string
                          port:
                            type: integer
                          timeout:
                            type: integer
                        required:
                        - host
                        - port
                        type: object
                      hdfs:
                        description: HdfsDataSource defines the information of the hdfs data source.
                        properties:
                          addresses:
                            items:
                              type: string
                            type: array
                          userName:
                            type: string
                        required:
                        - addresses
                        - userName
                        type: object
                    type: object
                  lifecycle:
                    description: Actions that the kube runtime should take in response to data events.
                    properties:
                      postDownload:
                        description: PostDownload is called after data downloaded.
                        properties:
                          exec:
                            description: ExecAction describes a "run in container" action.
                            properties:
                              command:
                                description: Command is the command line to execute inside the container, the working directory for the command  is root ('/') in the container's filesystem. The command is simply exec'd, it is not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use a shell, you need to explicitly call out to that shell. Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                                items:
                                  type: string
                                type: array
                            type: object
                          httpGet:
                            description: HTTPGetAction describes an action based on HTTP Get requests.
                            properties:
                              host:
                                description: Host name to connect to, defaults to the pod IP. You probably want to set "Host" in httpHeaders instead.
                                type: string
                              httpHeaders:
                                description: Custom headers to set in the request. HTTP allows repeated headers.
                                items:
                                  description: HTTPHeader describes a custom header to be used in HTTP probes
                                  properties:
                                    name:
                                      description: The header field name
                                      type: string
                                    value:
                                      description: The header field value
                                      type: string
                                  required:
                                  - name
                                  - value
                                  type: object
                                type: array
                              path:
                                description: Path to access on the HTTP server.
                                type: string
                              port:
                                anyOf:
                                - type: integer
                                - type: string
                                description: Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME.
                                x-kubernetes-int-or-string: true
                              scheme:
                                description: Scheme to use for connecting to the host. Defaults to HTTP.
                                type: string
                            required:
                            - port
                            type: object
                        type: object
                      preDownload:
                        description: PreDownload is called before data downloaded.
                        properties:
                          exec:
                            description: ExecAction describes a "run in container" action.
                            properties:
                              command:
                                description: Command is the command line to execute inside the container, the working directory for the command  is root ('/') in the container's filesystem. The command is simply exec'd, it is not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use a shell, you need to explicitly call out to that shell. Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                                items:
                                  type: string
                                type: array
                            type: object
                          httpGet:
                            description: HTTPGetAction describes an action based on HTTP Get requests.
                            properties:
                              host:
                                description: Host name to connect to, defaults to the pod IP. You probably want to set "Host" in httpHeaders instead.
                                type: string
                              httpHeaders:
                                description: Custom headers to set in the request. HTTP allows repeated headers.
                                items:
                                  description: HTTPHeader describes a custom header to be used in HTTP probes
                                  properties:
                                    name:
                                      description: The header field name
                                      type: string
                                    value:
                                      description: The header field value
                                      type: string
                                  required:
                                  - name
                                  - value
                                  type: object
                                type: array
                              path:
                                description: Path to access on the HTTP server.
                                type: string
                              port:
                                anyOf:
                                - type: integer
                                - type: string
                                description: Name or number of the port to access on the container. Number must be in the range 1 to 65535. Name must be an IANA_SVC_NAME.
                                x-kubernetes-int-or-string: true
                              scheme:
                                description: Scheme to use for connecting to the host. Defaults to HTTP.
                                type: string
                            required:
                            - port
                            type: object
                        type: object
                    type: object
                required:
                - dataItems
                - dataSources
                type: object
              workloadSelector:
                additionalProperties:
                  type: string
                description: Label selector for workloads. The DataSet will be applied to all workloads matching the selector.
                type: object
            required:
            - template
            - workloadSelector
            type: object
          status:
            description: Most recently observed status of the DataSet.
            properties:
              dataItems:
                type: integer
              ready:
                type: string
              replicas:
                type: integer
              success:
                type: integer
            required:
            - dataItems
            - ready
            - replicas
            - success
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: kuda-controller-manager
  namespace: kuda-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: webhook
  name: kuda-webhook
  namespace: kuda-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: webhook-init
  name: kuda-webhook-init
  namespace: kuda-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kuda-leader-election-role
  namespace: kuda-system
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: kuda-manager-role
rules:
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - list
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - pods/exec
  verbs:
  - create
  - get
  - list
  - patch
  - update
- apiGroups:
  - data.kuda.io
  resources:
  - datas
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - data.kuda.io
  resources:
  - datas/finalizers
  verbs:
  - update
- apiGroups:
  - data.kuda.io
  resources:
  - datas/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - data.kuda.io
  resources:
  - datasets
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - data.kuda.io
  resources:
  - datasets/finalizers
  verbs:
  - update
- apiGroups:
  - data.kuda.io
  resources:
  - datasets/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - rolebindings
  verbs:
  - create
  - get
  - list
  - update
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kuda-metrics-reader
rules:
- nonResourceURLs:
  - /metrics
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kuda-proxy-role
rules:
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: kuda-runtime-role
rules:
- apiGroups:
  - data.kuda.io
  resources:
  - datas
  verbs:
  - get
  - list
  - patch
  - update
- apiGroups:
  - data.kuda.io
  resources:
  - datas/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - pods/exec
  verbs:
  - get
  - list
  - patch
  - update
  - create
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: webhook
  name: kuda-webhook
rules:
- apiGroups:
  - '*'
  resources:
  - pods
  - secrets
  verbs:
  - '*'
- apiGroups:
  - data.kuda.io
  resources:
  - datasets
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: webhook-init
  name: kuda-webhook-init
rules:
- apiGroups:
  - '*'
  resources:
  - secrets
  verbs:
  - create
  - update
  - get
  - patch
  - list
- apiGroups:
  - certificates.k8s.io
  resources:
  - certificatesigningrequests
  - certificatesigningrequests/approval
  verbs:
  - get
  - create
  - update
  - delete
- apiGroups:
  - certificates.k8s.io
  resourceNames:
  - kubernetes.io/kubelet-serving
  resources:
  - signers
  verbs:
  - approve
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - get
  - create
  - update
  - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kuda-leader-election-rolebinding
  namespace: kuda-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: kuda-leader-election-role
subjects:
- kind: ServiceAccount
  name: kuda-controller-manager
  namespace: kuda-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kuda-manager-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kuda-manager-role
subjects:
- kind: ServiceAccount
  name: kuda-controller-manager
  namespace: kuda-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kuda-proxy-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kuda-proxy-role
subjects:
- kind: ServiceAccount
  name: kuda-controller-manager
  namespace: kuda-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: webhook
  name: kuda-webhook
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kuda-webhook
subjects:
- kind: ServiceAccount
  name: kuda-webhook
  namespace: kuda-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: webhook-init
  name: kuda-webhook-init
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kuda-webhook-init
subjects:
- kind: ServiceAccount
  name: kuda-webhook-init
  namespace: kuda-system
---
apiVersion: v1
data:
  controller_manager_config.yaml: |
    apiVersion: controller-runtime.sigs.k8s.io/v1alpha1
    kind: ControllerManagerConfig
    health:
      healthProbeBindAddress: :8081
    metrics:
      bindAddress: 127.0.0.1:8080
    webhook:
      port: 9443
    leaderElection:
      leaderElect: true
      resourceName: 19bb9482.kuda.io
kind: ConfigMap
metadata:
  name: kuda-manager-config
  namespace: kuda-system
---
apiVersion: v1
data:
  config.yaml: |
    runtimeImage: kuda4bigo/kuda-runtime:latest
    hostPath: /var/lib/kuda
    dataPathPrefix: /kuda/data
    enableAffinity: true
    runtimeServerPort: 8888
kind: ConfigMap
metadata:
  name: kuda-webhook-config
  namespace: kuda-system
---
apiVersion: v1
kind: Service
metadata:
  labels:
    control-plane: controller-manager
  name: kuda-controller-manager-metrics-service
  namespace: kuda-system
spec:
  ports:
  - name: https
    port: 8443
    protocol: TCP
    targetPort: https
  selector:
    control-plane: controller-manager
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: webhook
  name: kuda-webhook
  namespace: kuda-system
spec:
  ports:
  - port: 443
    targetPort: 8443
  selector:
    app: webhook
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    control-plane: controller-manager
  name: kuda-controller-manager
  namespace: kuda-system
spec:
  replicas: 1
  selector:
    matchLabels:
      control-plane: controller-manager
  template:
    metadata:
      labels:
        control-plane: controller-manager
    spec:
      containers:
      - args:
        - --secure-listen-address=0.0.0.0:8443
        - --upstream=http://127.0.0.1:8080/
        - --logtostderr=true
        - --v=10
        image: gcr.io/kubebuilder/kube-rbac-proxy:v0.8.0
        name: kube-rbac-proxy
        ports:
        - containerPort: 8443
          name: https
          protocol: TCP
      - args:
        - --health-probe-bind-address=:8081
        - --metrics-bind-address=127.0.0.1:8080
        - --leader-elect
        command:
        - /manager
        image: kuda4bigo/manager:latest
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8081
          initialDelaySeconds: 15
          periodSeconds: 20
        name: manager
        readinessProbe:
          httpGet:
            path: /readyz
            port: 8081
          initialDelaySeconds: 5
          periodSeconds: 10
        resources:
          limits:
            cpu: 200m
            memory: 100Mi
          requests:
            cpu: 100m
            memory: 20Mi
        securityContext:
          allowPrivilegeEscalation: false
      securityContext:
        runAsNonRoot: true
      serviceAccountName: kuda-controller-manager
      terminationGracePeriodSeconds: 10
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: webhook
  name: kuda-webhook
  namespace: kuda-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: webhook
  template:
    metadata:
      labels:
        app: webhook
    spec:
      containers:
      - args:
        - -port=8443
        - -certDir=/etc/webhook/certs
        image: kuda4bigo/webhook:latest
        imagePullPolicy: Always
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8081
          initialDelaySeconds: 15
          periodSeconds: 20
        name: webhook
        readinessProbe:
          httpGet:
            path: /readyz
            port: 8081
          initialDelaySeconds: 5
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/webhook/certs
          name: certs
          readOnly: true
        - mountPath: /etc/webhook/
          name: config
      serviceAccountName: kuda-webhook
      volumes:
      - name: certs
        secret:
          secretName: webhook-certs
      - configMap:
          name: kuda-webhook-config
        name: config
---
apiVersion: batch/v1
kind: Job
metadata:
  name: kuda-webhook-init
  namespace: kuda-system
spec:
  template:
    spec:
      containers:
      - command:
        - /webhook-init.sh
        - --service
        - kuda-webhook
        - --namespace
        - kuda-system
        - --secret
        - webhook-certs
        image: kuda4bigo/webhook-init:latest
        name: init
      restartPolicy: OnFailure
      serviceAccountName: kuda-webhook-init
